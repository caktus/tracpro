- extends "smartmin/base.html"
- load smartmin i18n

- block pre-content

  {% include 'polls/issue_header.haml' with issue=object %}

- block content

  - for question in questions
    %h3
      {{ question.order }}. {{ question.text }}

    .chart{ data-question-id:"{{ question.pk }}", data-question-type:"{{ question.type }}", dir:"ltr" }

    %script{ type:"text/javascript" }
      var chart_{{ question.pk }}_data = {{ question.chart_data }};


- block extra-script
  :javascript
    $(function() {
      $('.chart').each(function() {
        var container = $(this);
        var question_id = container.data('question-id');
        var question_type = container.data('question-type');
        var data = eval('chart_' + question_id + '_data');

        if (data && data.length > 0) {
          /* TODO vary chart type based on question type */
          init_chart_pie(container, data);
        }
        else {
          init_chart_nodata(container);
        }
      });
    });

    function init_chart_pie(container, data) {
      container.highcharts({
        title: null,
        tooltip: { enabled: false },
        plotOptions: {
          pie: {
            dataLabels: {
              enabled: true,
              format: '<b>{point.name}</b>: {point.percentage:.1f} %',
              style: {
                color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
              }
            }
          }
        },
        series: [{type: 'pie', data: data}],
        credits: { enabled: false }
      });
    }

    function init_chart_nodata(container) {
      container.addClass('chart-no-data');
      container.text("No data")
    }

- block extra-style
    {{ block.super }}
    :css
      .chart {
        min-width: 320px;
        max-width: 600px;
        height: 320px;
        margin: 0 auto
      }
      .chart-no-data {
        border: 2px dashed #DDDDDD;
        padding: 1em;
        height: auto !important;
        font-size: 20px;
        color: #DDDDDD;
        text-align: center;
      }
