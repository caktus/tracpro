{% extends "smartmin/base.html" %}

{% load i18n %}
{% load static %}

{% block pre-content %}
  {% include 'polls/poll_header.html' with poll=object %}
{% endblock pre-content %}

{% block extra-style %}
  <link rel="stylesheet" type="text/css"
        href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
{% endblock extra-style %}

{% block extra-script %}
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
  <script src="{% static "js/filters.js" %}"></script>
{% endblock extra-script %}

{% block content %}
  {% include "polls/_filters.html" with form=filter_form %}

  {% if questions and not request.region %}
    <p>
      {% blocktrans %}
        Charts only include data from non-regional poll runs.
        To see regional poll runs, choose a region from the dropdown in the navbar.
      {% endblocktrans %}
    </p>
  {% endif %}

  {% for question in questions %}
    <div class="poll-question">
      <h3>
        {{ forloop.counter }}. {{ question.name }}:
        <span class="data-type"></span>
      </h3>

      {% if question.date_list %}
        <div class="chart"
             data-name="{{ question.name }}"
             data-categories='[{% for d in question.date_list %}"{{ d|date:"Y-m-d" }}"{% if not forloop.last %},{% endif %}{% endfor %}]'
             data-window-min="{{ filter_form.start_date.value|date:"Y-m-d" }}"
             data-window-max="{{ filter_form.end_date.value|date:"Y-m-d" }}"
             data-type="{{ filter_form.data_type.value|lower }}"
             data-sum='{{ question.answer_sum_dict_list|safe }}'
             data-average='{{ question.answer_average_dict_list|safe }}'
             data-response-rate='{{ question.response_rate_dict_list|safe }}'>
        </div>
        <table class="table table-striped">
          <tbody>
            <tr class="read">
              <td class="read-half read-label">Mean</td>
              <td class="read-half read-value">{{ question.answer_mean }}</td>
            </tr>
            <tr class="read">
              <td class="read-half read-label">Standard Deviation</td>
              <td class="read-half read-value">{{ question.answer_stdev }}</td>
            </tr>
            <tr class="read">
              <td class="read-half read-label">Response Rate Average</td>
              <td class="read-half read-value">{{ question.response_rate_average }}%</td>
            </tr>
          </tbody>
        </table>
      {% else %}
        <div class="chart-no-data">No data for this date window.</div>
      {% endif %}
    </div>
  {% endfor %}
{% endblock content %}
